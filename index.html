<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock QR Scanner & Gen</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            text-align: center;
            background: #f4f7f6;
            color: #333;
        }

        #reader {
            width: 100%;
            max-width: 400px;
            margin: 20px auto;
            border: 5px solid #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .form-group {
            margin: 15px 0;
            text-align: left;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        label { font-weight: bold; }

        input {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 18px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            margin-top: 10px;
            transition: 0.3s;
        }

        button:hover { background: #218838; }

        #qrcode {
            margin-top: 25px;
            display: flex;
            justify-content: center;
            padding: 10px;
            background: white;
            display: inline-block;
            border-radius: 10px;
        }

        hr { border: 0; height: 1px; background: #ddd; margin: 30px 0; }
    </style>
</head>

<body>

    <h2>üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Scan & Gen)</h2>

    <div id="reader"></div>
    <p id="scan-status">üé• ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏Å‡∏ô...</p>

    <hr>

    <div class="form-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
        <input type="text" id="prodName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
    </div>
    <div class="form-group">
        <label>‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</label>
        <input type="text" id="prodType" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÉ‡∏ä‡πâ">
    </div>
    <div class="form-group">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤:</label>
        <input type="date" id="importDate">
    </div>

    <button onclick="generateNewQR()">‡∏™‡∏£‡πâ‡∏≤‡∏á QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ</button>

    <div id="qrcode"></div>
    <p id="qrText" style="display:none; color: #666; font-size: 14px; margin-top: 10px;">
        ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏™‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    </p>

    <script>
        // 1. ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏Å‡∏ô (Scanner)
        let isScanning = true; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏∏‡∏°‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏Å‡∏ô‡∏ã‡πâ‡∏≥‡πÄ‡∏î‡πâ‡∏á‡∏£‡∏±‡∏ß

        function onScanSuccess(decodedText) {
            if (isScanning) {
                // ‡∏ñ‡πâ‡∏≤‡πÅ‡∏™‡∏Å‡∏ô‡πÄ‡∏à‡∏≠‡∏•‡∏¥‡∏á‡∏Å‡πå (URL) ‡πÉ‡∏´‡πâ‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏±‡πâ‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                if (decodedText.startsWith("http")) {
                    isScanning = false; // ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏™‡∏Å‡∏ô
                    window.location.href = decodedText;
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏™‡πà‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥
                    document.getElementById('prodName').value = decodedText;
                    alert("‡∏î‡∏∂‡∏á‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + decodedText);
                }
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á
        let html5QrcodeScanner = new Html5QrcodeScanner("reader", { 
            fps: 10, 
            qrbox: 250,
            rememberLastUsedCamera: true 
        });
        html5QrcodeScanner.render(onScanSuccess);


        // 2. ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á QR (Generator)
        function generateNewQR() {
            const name = document.getElementById('prodName').value;
            const type = document.getElementById('prodType').value;
            const date = document.getElementById('importDate').value;

            if(!name || !date) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
                return;
            }

            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö URL
            const encName = encodeURIComponent(name);
            const encType = encodeURIComponent(type);
            const encDate = encodeURIComponent(date);

            // ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
            const myWebsite = "https://kayzyysm.github.io/qrscan/view.html";
            const finalURL = `${myWebsite}?name=${encName}&type=${encType}&date=${encDate}`;

            console.log("‡∏™‡∏£‡πâ‡∏≤‡∏á QR ‡∏•‡∏¥‡∏á‡∏Å‡πå:", finalURL);

            const qrContainer = document.getElementById("qrcode");
            qrContainer.innerHTML = '<canvas id="qr-canvas"></canvas>';

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ QR Code
            new QRious({
                element: document.getElementById('qr-canvas'),
                value: finalURL,
                size: 250,
                level: 'M'
            });

            document.getElementById("qrText").style.display = "block";
            
            // ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏•‡∏á‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏π‡∏õ QR
            window.scrollTo(0, document.body.scrollHeight);
        }
    </script>
</body>

</html>